---
title: Frontend Considerations
prev_page: 4_frontend
next_page: 5_wrapping-up
---

## Useful data

Now that we have the signed payload, we will send it to the Staking API which will then broadcast the complete transaction to the NEAR network.

Let's break down the code in `pages/api/near-delegate/broadcast-transaction.ts`:

```js
...
        const response = await fetch(`https://${HOSTNAME}${ENDPOINT}`, {
            method: 'PUT',
            headers: {
                "Authorization" : process.env.API_KEY as string,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                "name": "sign_delegate_tx",
                "inputs": {
                    "transaction_payload": body.signed_payload
                }
            })
        })
...

```

- When using cross-fetch in this way to communicate with the Staking API directly, we can pass the signed transaction payload in the request body.

- Refer to the <Link href="https://docs.figment.io/guides/staking-api/" rel="noopener noreferrer" target="_blank">Figment Documentation</Link> when necessary, to help you understand the Staking API.

Let's also look at how we're handling the client-side code in `pages/near-delegate/broadcast-transaction.tsx`:

```js
import Link from "next/link";
import { FormEvent, useState, useEffect } from "react";
import styles from "/styles/Home.module.css";
import { useRouter } from 'next/router'

export default function PageWithJSbasedForm() {
  const router = useRouter()

  const [transactionPayload, setTransactionPayload] = useState();
  const [signedTransactionPayload, setSignedTransactionPayload] = useState("")
  const [flowState, setFlowState] = useState();
  const [accountPubKey, setAccountPubKey] = useState("")
  const [accountAddress, setAccountAddress] = useState("")
  const [flowId, setFlowId] = useState("")

  // Get the Public Key, Address and Current Flow ID from localStorage
  useEffect(() => {
    setAccountPubKey(localStorage.getItem('DEMO_NEAR_PUBKEY') as string)
    setAccountAddress(localStorage.getItem('DEMO_NEAR_ADDRESS') as string)
    setFlowId(localStorage.getItem('DEMO_STAKING_FLOW') as string)
    setSignedTransactionPayload(localStorage.getItem('SIGNED_PAYLOAD') as string)  
  }, [])

  const handleNextPage = async () => {
    router.push("/near-delegate/get-flow-state")
  }

  const handleSubmit = async (event: FormEvent) => {
    // Handle the submit event on form submit.
    // Stop the form from submitting and refreshing the page.
    event.preventDefault();

    // Cast the event target to an html form
    const form = event.target as HTMLFormElement;

    // Get data from the form.
    const data = {
      flow_id: flowId,
      action: form.flowAction.value as string,
      signed_payload: form.signed_payload.value as string,
    }

    const response = await fetch("/api/near-delegate/broadcast-transaction", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data)
    });

    // Get the response data from server as JSON.
    const result = await response.json();

    if (result.code) {
      alert(`${result.code}: ${result.message}`)
    }

    if (result.data) {
      console.log("transaction state: ", result.state)
      setFlowState(result.state)
    }

  };
```

- The `result` variable here contains the JSON data we want. If there were an error, we can handle it on the client-side by doing something when the `code` (meaning error code) property exists in the JSON response.

- When the `result` contains a `data` property, we know it is a successful response and so in this case we want to report the current state of the flow, which would be `delegate_tx_broadcasting`. Once the transaction has been confirmed on-chain, the state will become `delegated` and the flow will be complete.

- The `return` value is where we can structure our page content and perform any conditional rendering.

```js
  return (<>
    <div className="container">
      <h1 className={styles.title}>Submit Signed Delegate Transaction for Broadcast</h1>

      <p className={styles.description}>
        After signing the transaction, provide the signed <code>transaction_payload</code>. 
        The Staking API will broadcast the transaction to the NEAR network.
      </p>
      <br /><br />

      <p>Current Flow ID: <b>{flowId}</b></p>

      <form onSubmit={handleSubmit} method="post">

        <label htmlFor="action">Action:</label>
        <select id="action" name="flowAction" required defaultValue="sign_delegate_tx">
          <option value="sign_delegate_tx">sign_delegate_tx</option>
          <option disabled value="refresh_delegate_tx">refresh_delegate_tx</option>
        </select>

        <br />

        <label htmlFor="signed_payload">Signed Transaction Payload</label>
        <input type="text" id="signed_payload" name="signed_payload" defaultValue={signedTransactionPayload} />

        <button type="submit">Broadcast Transaction</button>
      </form>

      <p> Transaction State </p>

      <br />

      {flowState
        ? <div className="payload">{flowState}</div>
        : ""
      }

      {flowState
        ? <button className="nextPage" type="button" onClick={handleNextPage}>Next Step</button>
        : ""
      }
    </div>
  </>);
}
```
